(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{357:function(s,t,e){s.exports=e.p+"assets/img/d2d5e989b08fecbb558537b5c3db62bf2b9915e0103fe33de607a0d05f9d2519.4da7aaa8.png"},358:function(s,t,e){s.exports=e.p+"assets/img/42bb2539b306c2118ff5d632d5b2fd13fcdb7108717969f07959d48d321b034e.badcedc6.png"},359:function(s,t,e){s.exports=e.p+"assets/img/5d48aedb41eab2d1f41a9d66a831df23f71413808735536b08df73388567164b.953629e1.png"},360:function(s,t,e){s.exports=e.p+"assets/img/5be6cf4792e5744e767b42c7a8314387c613aa29a7c7097d5992eb975220d5fe.f43adcb6.png"},456:function(s,t,e){"use strict";e.r(t);var a=e(25),v=Object(a.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("告警通知模板提供了根据告警内容组装发送内容的能力，比如告警内容中发送的都是json，可以将json中的数据组合发送到通知人。")]),s._v(" "),a("h2",{attrs:{id:"通知模板配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通知模板配置"}},[s._v("#")]),s._v(" 通知模板配置")]),s._v(" "),a("p",[s._v("暂且先不说预定义、自定义和默认模板的区别，先说下通知模板如何配置。")]),s._v(" "),a("p",[s._v("比如现在有一个告警，告警内容为一个复杂的JSON，如下所示（为简化，下面其他示例只会展示 "),a("code",[s._v("ctn")]),s._v(" 字段的内容）：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X POST "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'https://alarm-dog-service.domain.com/alarm/report'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -H "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Type: application/json'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -d "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{\n        "taskid": 123,\n        "timestamp": 1592378746,\n        "sign": "c039ad9a37a8b88ad59d200ac7d10c56",\n        "ctn": {\n            "errno": 10086,\n            "error": "您的余额已不足",\n            "context": {\n                "class": {\n                    "id": 111,\n                    "name": "哮天犬演示课"\n                },\n                "time": {\n                    "date": "2020-06-17",\n                    "time": "15:30:00"\n                }\n            }\n        },\n        "level": 1,\n        "notice_time": 1592378746\n    }\'')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("p",[s._v("我们可以在通知模板中配置如下模板：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("您有一条告警，请注意处理\n错误码：{history.ctn.errno}\n错误信息：{history.ctn.error}\n课程：{history.ctn.context.class.name}（ID：{history.ctn.context.class.id}）\n时间：{history.ctn.context.time}\nHost：{history.ctn.hostname}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("我们接收到告警的内容将是：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('您有一条告警，请注意处理\n错误码：10086\n错误信息：您的余额已不足\n课程：哮天犬演示课（ID：111）\n时间：{"date": "2020-06-17", "time": "15:30:00"}\nHost：{history.ctn.hostname}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("从上面的示例可以看出，告警模板实际上是将模板中格式为 "),a("code",[s._v("{}")]),s._v(" 的特殊标记（以下都称为模板变量）替换为告警内容中JSON对应key的值，如果值为标量，则原样输出，例如 "),a("code",[s._v("{history.ctn.errno}")]),s._v("；如果值为非标量，则输出为JSON字符串，例如 "),a("code",[s._v("{history.ctn.context.time}")]),s._v("；如果对应的key不存在，则不进行替换，例如 "),a("code",[s._v("{history.ctn.hostname}")]),s._v("。")]),s._v(" "),a("p",[s._v("模板变量可以通过小数点 "),a("code",[s._v(".")]),s._v(" 访问无限层级的JSON对象"),a("RouterLink",{attrs:{to:"/preface/concept.html#json数据类型"}},[a("sup",[s._v("[概念介绍]")])]),s._v("，例如 "),a("code",[s._v("ctn")]),s._v("、"),a("code",[s._v("context")]),s._v("、"),a("code",[s._v("class")]),s._v(" 均为JSON对象，所以可以通过 "),a("code",[s._v("{history.ctn.context.class.name}")]),s._v(" 访问到 "),a("code",[s._v("class")]),s._v(" 对象中的 "),a("code",[s._v("name")]),s._v(" 的值。")],1),s._v(" "),a("p",[s._v("我们还发现 "),a("code",[s._v("ctn")]),s._v(" 字段外层还有一个 "),a("code",[s._v("history")]),s._v(" 字段，这个字段相当于是命名空间，因为哮天犬提供了很多模板变量，为了很好的区分各变量的含义，故在变量的前面加了命名空间。"),a("code",[s._v("history")]),s._v(" 表示的是告警记录这组变量的命名空间，哮天犬还提供了其他的可以变量，请参考"),a("a",{attrs:{href:"#%E5%8F%AF%E7%94%A8%E6%A8%A1%E6%9D%BF%E5%8F%98%E9%87%8F"}},[s._v("可用模板变量")]),s._v("。")]),s._v(" "),a("h2",{attrs:{id:"模板场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模板场景"}},[s._v("#")]),s._v(" 模板场景")]),s._v(" "),a("p",[s._v("告警场景主要是根据四种不同需要告警发送的高级功能出现的，包括告警被收敛、告警未收敛、告警升级、告警恢复四种场景。告警属于哪种模板场景就是用哪个场景下的模板发送告警。")]),s._v(" "),a("p",[a("img",{attrs:{src:e(357),alt:"图 17"}})]),s._v(" "),a("h3",{attrs:{id:"告警被收敛"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#告警被收敛"}},[s._v("#")]),s._v(" 告警被收敛")]),s._v(" "),a("p",[s._v("即告警任务开启了告警收敛功能，且告警命中了收敛规则，此时会以告警被收敛的场景发送告警。")]),s._v(" "),a("h3",{attrs:{id:"告警未收敛"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#告警未收敛"}},[s._v("#")]),s._v(" 告警未收敛")]),s._v(" "),a("p",[s._v("即告警未开启收敛功能，或者开启了收敛功能但未命中收敛规则，此时会以告警未收敛的场景发送告警。")]),s._v(" "),a("h3",{attrs:{id:"告警升级"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#告警升级"}},[s._v("#")]),s._v(" 告警升级")]),s._v(" "),a("p",[s._v("即告警开启了告警升级功能，且触发了告警升级，此时会以告警升级的场景发送告警。")]),s._v(" "),a("h3",{attrs:{id:"告警恢复"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#告警恢复"}},[s._v("#")]),s._v(" 告警恢复")]),s._v(" "),a("p",[s._v("即告警开启了告警恢复功能，且触发了告警恢复，此时会以告警恢复的场景发送告警。")]),s._v(" "),a("h2",{attrs:{id:"模板类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模板类型"}},[s._v("#")]),s._v(" 模板类型")]),s._v(" "),a("p",[s._v("告警模板分为三种类型，分别为预定义模板、自定义模板、默认模板。")]),s._v(" "),a("h3",{attrs:{id:"预定义模板"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#预定义模板"}},[s._v("#")]),s._v(" 预定义模板")]),s._v(" "),a("p",[s._v("预定义模板指的是通过在哮天犬后台 【告警管理 / 通知模板】菜单创建的模板，此处的模板可以关联到任意告警任务中，可以很好的实现告警模板的复用。预定义模板里面每个告警场景、告警通知渠道有可能是自定义模板或者默认模板，但至少有一个是自定义模板。")]),s._v(" "),a("p",[a("img",{attrs:{src:e(358),alt:"图 14"}})]),s._v(" "),a("p",[a("img",{attrs:{src:e(359),alt:"图 15"}})]),s._v(" "),a("h3",{attrs:{id:"自定义模板"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自定义模板"}},[s._v("#")]),s._v(" 自定义模板")]),s._v(" "),a("p",[s._v("如图所示，某个告警场景的告警通知渠道模板内容被修改，这种模板属于自定义模板，即被修改过的模板。自定义模板能根据自己想要的格式进行修改，能增加告警的可读性，建议修改默认模板。")]),s._v(" "),a("p",[a("img",{attrs:{src:e(360),alt:"图 16"}})]),s._v(" "),a("h3",{attrs:{id:"默认模板"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#默认模板"}},[s._v("#")]),s._v(" 默认模板")]),s._v(" "),a("p",[s._v("如上图所示，模板没有做任何修改，这种模板为默认模板。默认模板发送时会使用系统默认的模板发送告警，有可能存在哮天犬平台调整默认模板导致告警发送内容稍有差异。且为了能使任何告警内容输出，告警内容会以 "),a("code",[s._v("{history.ctn}")]),s._v(" 的模板变量使用JSON的形式发送到通知人，可能会影响可读性，建议配置告警模板。")]),s._v(" "),a("h2",{attrs:{id:"可用模板变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#可用模板变量"}},[s._v("#")]),s._v(" 可用模板变量")]),s._v(" "),a("h3",{attrs:{id:"告警收敛场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#告警收敛场景"}},[s._v("#")]),s._v(" 告警收敛场景")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("task")]),s._v("：告警任务信息\n"),a("ul",[a("li",[a("code",[s._v("task.id")]),s._v(": 告警任务ID")]),s._v(" "),a("li",[a("code",[s._v("task.name")]),s._v(": 告警任务名称")])])]),s._v(" "),a("li",[a("code",[s._v("history")]),s._v(": 告警记录\n"),a("ul",[a("li",[a("code",[s._v("history.id")]),s._v(": 告警记录ID")]),s._v(" "),a("li",[a("code",[s._v("history.uuid")]),s._v(": 告警记录唯一ID")]),s._v(" "),a("li",[a("code",[s._v("history.batch")]),s._v(": 收敛批次")]),s._v(" "),a("li",[a("code",[s._v("history.metric")]),s._v(": 收敛指标")]),s._v(" "),a("li",[a("code",[s._v("history.notice_time")]),s._v(": 告警通知时间")]),s._v(" "),a("li",[a("code",[s._v("history.level")]),s._v(": 告警级别")]),s._v(" "),a("li",[a("code",[s._v("history.ctn")]),s._v(": 告警内容")]),s._v(" "),a("li",[a("code",[s._v("history.receiver")]),s._v(": 自定义通知人配置，JSON格式，如果未传则为空")])])]),s._v(" "),a("li",[a("code",[s._v("common")]),s._v(": 系统变量\n"),a("ul",[a("li",[a("code",[s._v("common.env")]),s._v(": 环境标识，例如 [生产环境]、[测试环境]")])])])]),s._v(" "),a("h3",{attrs:{id:"告警未收敛场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#告警未收敛场景"}},[s._v("#")]),s._v(" 告警未收敛场景")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("task")]),s._v("：告警任务信息\n"),a("ul",[a("li",[a("code",[s._v("task.id")]),s._v(": 告警任务ID")]),s._v(" "),a("li",[a("code",[s._v("task.name")]),s._v(": 告警任务名称")])])]),s._v(" "),a("li",[a("code",[s._v("history")]),s._v(": 告警记录\n"),a("ul",[a("li",[a("code",[s._v("history.uuid")]),s._v(": 告警记录唯一ID")]),s._v(" "),a("li",[a("code",[s._v("history.notice_time")]),s._v(": 告警通知时间")]),s._v(" "),a("li",[a("code",[s._v("history.level")]),s._v(": 告警级别")]),s._v(" "),a("li",[a("code",[s._v("history.ctn")]),s._v(": 告警内容")]),s._v(" "),a("li",[a("code",[s._v("history.receiver")]),s._v(": 自定义通知人配置，JSON格式，如果未传则为空")])])]),s._v(" "),a("li",[a("code",[s._v("common")]),s._v(": 系统变量\n"),a("ul",[a("li",[a("code",[s._v("common.env")]),s._v(": 环境标识，例如 [生产环境]、[测试环境]")])])])]),s._v(" "),a("h3",{attrs:{id:"告警升级场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#告警升级场景"}},[s._v("#")]),s._v(" 告警升级场景")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("task")]),s._v("：告警任务信息\n"),a("ul",[a("li",[a("code",[s._v("task.id")]),s._v(": 告警任务ID")]),s._v(" "),a("li",[a("code",[s._v("task.name")]),s._v(": 告警任务名称")])])]),s._v(" "),a("li",[a("code",[s._v("context")]),s._v(": 上下文配置信息\n"),a("ul",[a("li",[a("code",[s._v("context.rule")]),s._v(": 当前告警升级规则配置，JSON格式")]),s._v(" "),a("li",[a("code",[s._v("context.zcount")]),s._v(": 触发规则的计数值")])])]),s._v(" "),a("li",[a("code",[s._v("history")]),s._v(": 告警记录\n"),a("ul",[a("li",[a("code",[s._v("history.id")]),s._v(": 告警记录ID")]),s._v(" "),a("li",[a("code",[s._v("history.uuid")]),s._v(": 告警记录唯一ID")]),s._v(" "),a("li",[a("code",[s._v("history.batch")]),s._v(": 收敛批次")]),s._v(" "),a("li",[a("code",[s._v("history.metric")]),s._v(": 收敛指标")]),s._v(" "),a("li",[a("code",[s._v("history.notice_time")]),s._v(": 告警通知时间")]),s._v(" "),a("li",[a("code",[s._v("history.level")]),s._v(": 告警级别")]),s._v(" "),a("li",[a("code",[s._v("history.ctn")]),s._v(": 告警内容")]),s._v(" "),a("li",[a("code",[s._v("history.receiver")]),s._v(": 自定义通知人配置，JSON格式，如果未传则为空")])])]),s._v(" "),a("li",[a("code",[s._v("common")]),s._v(": 系统变量\n"),a("ul",[a("li",[a("code",[s._v("common.env")]),s._v(": 环境标识，例如 [生产环境]、[测试环境]")])])])]),s._v(" "),a("h3",{attrs:{id:"告警恢复场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#告警恢复场景"}},[s._v("#")]),s._v(" 告警恢复场景")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("task")]),s._v("：告警任务信息\n"),a("ul",[a("li",[a("code",[s._v("task.id")]),s._v(": 告警任务ID")]),s._v(" "),a("li",[a("code",[s._v("task.name")]),s._v(": 告警任务名称")])])]),s._v(" "),a("li",[a("code",[s._v("history")]),s._v(": 告警记录\n"),a("ul",[a("li",[a("code",[s._v("history.uuid")]),s._v(": 告警记录唯一ID")]),s._v(" "),a("li",[a("code",[s._v("history.notice_time")]),s._v(": 告警通知时间")]),s._v(" "),a("li",[a("code",[s._v("history.level")]),s._v(": 告警级别")]),s._v(" "),a("li",[a("code",[s._v("history.ctn")]),s._v(": 告警内容")]),s._v(" "),a("li",[a("code",[s._v("history.receiver")]),s._v(": 自定义通知人配置，JSON格式，如果未传则为空")])])]),s._v(" "),a("li",[a("code",[s._v("common")]),s._v(": 系统变量\n"),a("ul",[a("li",[a("code",[s._v("common.env")]),s._v(": 环境标识，例如 [生产环境]、[测试环境]")])])])])])}),[],!1,null,null,null);t.default=v.exports}}]);