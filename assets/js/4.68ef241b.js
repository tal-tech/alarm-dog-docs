(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{397:function(a,t,e){a.exports=e.p+"assets/img/e2a5fc68e9301812ac2db77074f5509daf2649dfa24c241b5bb30e5851bb1455.f0cb51d5.png"},398:function(a,t,e){a.exports=e.p+"assets/img/19acf27d2a8ac71d9c5fbd635de34878c9d92adbb0613c4185dcbf70116dc70f.26f0a0fb.png"},399:function(a,t,e){a.exports=e.p+"assets/img/959a51f3b3fafee6c23b846e608d4c91755918a1a6e4756a318faa9d6baf6c37.1805bf83.png"},400:function(a,t,e){a.exports=e.p+"assets/img/42cf5bd8106d33a0ff1a813d753ad48fcafab2733657f7b17ce9ffc57141cd4f.239a49f2.png"},401:function(a,t,e){a.exports=e.p+"assets/img/86006dd556a02d10f5a8d31515499ea3e1b7fd905eb712ecec9cd93dac1470ea.063083e2.png"},402:function(a,t,e){a.exports=e.p+"assets/img/fb0e8cbc02aee7d7ffa169b6b84ff7c25adaac859827b00cce598f6575f77c20.6375e327.png"},403:function(a,t,e){a.exports=e.p+"assets/img/00be1a8a955ae79e677a807571a58e21bc0d1fddc8e4d88264e7441b1654f965.da86f666.png"},404:function(a,t,e){a.exports=e.p+"assets/img/5e0b629736a1c185e85b56db9168abcce6b3cb363bb43322871443c17321ffb7.691a13c8.png"},405:function(a,t,e){a.exports=e.p+"assets/img/51573a3d343510a0765dce55d3af4451f1b414a5658a931d757147f2e2458bac.fd7af5ca.png"},406:function(a,t,e){a.exports=e.p+"assets/img/a5eac52ae010be9d758b07a8cb2ed8ee04f3582204955a3d5aa0efd21551e9a0.80d2cff4.png"},407:function(a,t,e){a.exports=e.p+"assets/img/ee23d3cad96d3b832ddb2ea7cb7543331afb59aeb083af5f60756248472838e4.b098cf09.png"},408:function(a,t,e){a.exports=e.p+"assets/img/fff2d89bdb8c1c5bb431f7a0f9e705e588f8253142df994477479f80d492526d.dcb6fbe7.png"},409:function(a,t,e){a.exports=e.p+"assets/img/4f63a3758895f07ec33ba4d83bebfbc875218564a32f28a1fa78cb57b9154153.dceccf6e.png"},469:function(a,t,e){"use strict";e.r(t);var s=e(25),c=Object(s.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("p",[a._v("哮天犬提供了对Grafana告警的支持，Grafana原生的告警虽然很强大，但是一般我们使用的都是钉钉告警、邮件告警，如果要实现其他渠道的告警，需要配合队列来实现，成本特别高，同时邮件告警还需要在Grafana的服务器上事先配置好了邮箱smtp服务，而这个对于普通研发来说，是很难申请或者其他渠道获得的。为此，哮天犬使用Grafana的钉钉告警，将Grafana的钉钉告警推送到哮天犬，然后哮天犬将告警再进行分发，使告警可以发送到钉钉工作通知、钉钉群、知音楼工作通知、知音楼群、短信、电话、邮件等渠道，并且可以很方便的查看告警记录，可以使用哮天犬的告警收敛等一系列高级功能。下面讲一下详细步骤：")]),a._v(" "),s("h2",{attrs:{id:"step1：创建哮天犬告警任务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#step1：创建哮天犬告警任务"}},[a._v("#")]),a._v(" Step1：创建哮天犬告警任务")]),a._v(" "),s("p",[a._v("前往哮天犬后台 "),s("a",{attrs:{href:"https://alarm-dog.domain.com",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://alarm-dog.domain.com"),s("OutboundLink")],1),a._v("，在告警任务菜单页点击创建告警任务，基本信息、告警通知人等根据实际情况填写，自动恢复和通知模板需要特殊配置一下，否则发送出来的内容可读性非常差。")]),a._v(" "),s("p",[a._v("在自动恢复这里，开启自动恢复，并选择恢复方式为 "),s("code",[a._v("条件恢复")]),a._v("，然后字段填写 "),s("code",[a._v("ctn.title")]),a._v("，条件选择 "),s("code",[a._v("包含")]),a._v("，阈值填写 "),s("code",[a._v("[OK]")]),a._v("。至此，自动恢复已配置完成。")]),a._v(" "),s("p",[s("img",{attrs:{src:e(397),alt:"图 13"}})]),a._v(" "),s("p",[a._v("接着切换到通知模板，然后搜索 "),s("code",[a._v("grafana告警")]),a._v("，选择该模板：")]),a._v(" "),s("p",[s("img",{attrs:{src:e(398),alt:"图 14"}})]),a._v(" "),s("p",[a._v("如果觉得默认模板不满意，可以选中之后，点另存为重新编辑，保存之后搜索另存为的模板名称即可：")]),a._v(" "),s("p",[s("img",{attrs:{src:e(399),alt:"图 15"}})]),a._v(" "),s("p",[s("img",{attrs:{src:e(400),alt:"图 16"}})]),a._v(" "),s("p",[a._v("有关告警模板的编辑，请参考："),s("RouterLink",{attrs:{to:"/advance-function/alarm-template.html"}},[a._v("告警模板")])],1),a._v(" "),s("h2",{attrs:{id:"step2：获取grafana告警的url"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#step2：获取grafana告警的url"}},[a._v("#")]),a._v(" Step2：获取Grafana告警的URL")]),a._v(" "),s("p",[a._v("告警任务创建完成之后，页面会自动跳转到告警任务详情页，在详情页，找到Grafana告警这一项，然后复制该URL以备使用。")]),a._v(" "),s("p",[s("img",{attrs:{src:e(401),alt:"图 17"}})]),a._v(" "),s("h2",{attrs:{id:"step3：前往grafana配置通知渠道"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#step3：前往grafana配置通知渠道"}},[a._v("#")]),a._v(" Step3：前往Grafana配置通知渠道")]),a._v(" "),s("p",[a._v("登录Grafana之后，在左侧菜单找到 "),s("code",[a._v("Alerting菜单（警铃符号）")]),a._v("，然后点击 "),s("code",[a._v("Notification Channels")]),a._v(" 菜单，进入到通知渠道配置：")]),a._v(" "),s("p",[s("img",{attrs:{src:e(402),alt:"图 18"}})]),a._v(" "),s("p",[a._v("点击左上角 "),s("code",[a._v("New Channel")]),a._v(" 菜单，进入到通知渠道创建页面，"),s("code",[a._v("Type")]),a._v(" 选择 "),s("code",[a._v("DingDing")]),a._v("，"),s("code",[a._v("Url")]),a._v(" 填写刚刚复制的Grafana告警的URL：")]),a._v(" "),s("p",[s("img",{attrs:{src:e(403),alt:"图 19"}})]),a._v(" "),s("p",[a._v("按要求配置好之后，可以点 "),s("code",[a._v("Send Test")]),a._v(" 测试是否能收到测试告警，下面是知音楼机器人（知音楼群）收到的告警：")]),a._v(" "),s("p",[s("img",{attrs:{src:e(404),alt:"图 20"}})]),a._v(" "),s("h2",{attrs:{id:"step4：配置告警"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#step4：配置告警"}},[a._v("#")]),a._v(" Step4：配置告警")]),a._v(" "),s("p",[a._v("进入到要配置告警的Dashboard，然后找到要配置的面板，点击面板名称，然后点击 "),s("code",[a._v("Edit")]),a._v("，进入到编辑页面：")]),a._v(" "),s("p",[s("img",{attrs:{src:e(405),alt:"图 21"}})]),a._v(" "),s("p",[a._v("切换到 "),s("code",[a._v("Alert")]),a._v(" 选项卡，根据实际需求配置告警规则，然后在 "),s("code",[a._v("Send to")]),a._v(" 那一项那里填写刚刚的通知渠道：")]),a._v(" "),s("p",[s("img",{attrs:{src:e(406),alt:"图 22"}})]),a._v(" "),s("p",[a._v("然后点击保存即可，支持Grafana的告警全部配置完成。")]),a._v(" "),s("p",[s("img",{attrs:{src:e(407),alt:"图 23"}})]),a._v(" "),s("h2",{attrs:{id:"实际效果"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实际效果"}},[a._v("#")]),a._v(" 实际效果")]),a._v(" "),s("p",[a._v("如果一旦有告警，会在哮天犬配置的任务中的各通知渠道发送告警，下面截图是告警发送到知音楼群的示例：")]),a._v(" "),s("p",[s("img",{attrs:{src:e(408),alt:"图 24"}})]),a._v(" "),s("p",[a._v("如果告警恢复，则会收到如下告警：")]),a._v(" "),s("p",[s("img",{attrs:{src:e(409),alt:"图 25"}})]),a._v(" "),s("p",[a._v("如果觉得发送的告警比较丑，想自己优化，请参考 "),s("a",{attrs:{href:"#step1%EF%BC%9A%E5%88%9B%E5%BB%BA%E5%93%AE%E5%A4%A9%E7%8A%AC%E5%91%8A%E8%AD%A6%E4%BB%BB%E5%8A%A1"}},[a._v("#Step1")]),a._v(" 中的告警通知模板另存为的说明。")])])}),[],!1,null,null,null);t.default=c.exports}}]);